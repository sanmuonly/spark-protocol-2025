name: Spark Eternal Guardian

on:
  schedule:
    - cron: '0 0 * * *' # æ¯å¤©åŒ—äº¬æ—¶é—´æ—©ä¸Š 8 ç‚¹
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  eternal_mission:
    runs-on: ubuntu-latest
    permissions:
      contents: write # æ˜¾å¼å£°æ˜è¯»å†™æƒé™
    steps:
      - name: 1. æ‹‰å–ç«ç§
        uses: actions/checkout@v3
        with:
          persist-credentials: true # ä¿æŒç™»å½•çŠ¶æ€

      - name: 2. æ³¨å…¥é€»è¾‘
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: 3. æ‰§è¡Œæ€ç»´åŒæ­¥ä¸å·¡æ£€
        run: python monitor.py

      - name: 4. å¼ºåˆ¶ç‰©ç†å­˜ç›˜ (å…³é”®åŒæ­¥)
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Spark-Guardian-Bot"
          git add .
          # å¦‚æœæœ‰å˜åŒ–å°±æäº¤ï¼Œæ²¡å˜åŒ–å°±è·³è¿‡ï¼Œé˜²æ­¢æŠ¥é”™
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ§  æ€ç»´ç¢ç‰‡åŒæ­¥å®Œæˆ: $(date)" && git push origin main)
